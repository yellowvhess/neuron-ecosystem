<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Neuron Drive - P2P –û–±–ª–∞–∫–æ</title>
    <script src="https://cdn.jsdelivr.net/webtorrent/latest/webtorrent.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --bg: #0f0f23;
            --card-bg: #1a1b2e;
            --text: #ffffff;
            --text-secondary: #a0a0c0;
        }

        body {
            background: var(--bg);
            color: var(--text);
            font-family: 'Segoe UI', system-ui, sans-serif;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .stats {
            display: flex;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--card-bg);
            padding: 1.5rem;
            border-radius: 10px;
            flex: 1;
            text-align: center;
        }

        .upload-area {
            border: 2px dashed var(--primary);
            border-radius: 15px;
            padding: 3rem;
            text-align: center;
            margin: 2rem 0;
            background: rgba(99, 102, 241, 0.05);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .upload-area:hover {
            background: rgba(99, 102, 241, 0.1);
        }

        .files-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1rem;
            margin-top: 2rem;
        }

        .file-card {
            background: var(--card-bg);
            border-radius: 10px;
            padding: 1.5rem;
            transition: all 0.3s ease;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .file-card:hover {
            transform: translateY(-5px);
            border-color: var(--primary);
        }

        .file-icon {
            font-size: 2rem;
            margin-bottom: 1rem;
            color: var(--primary);
        }

        .file-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
            flex: 1;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-secondary {
            background: rgba(255,255,255,0.1);
            color: var(--text);
        }

        .back-btn {
            background: rgba(255,255,255,0.1);
            color: var(--text);
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 5px;
            cursor: pointer;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div>
                <h1><i class="fas fa-cloud"></i> Neuron Drive</h1>
                <p style="color: var(--text-secondary);">P2P –æ–±–ª–∞—á–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ</p>
            </div>
            <a href="index.html" class="back-btn">
                <i class="fas fa-arrow-left"></i> –ù–∞–∑–∞–¥
            </a>
        </div>

        <div class="stats">
            <div class="stat-card">
                <h3 id="totalFiles">0</h3>
                <p style="color: var(--text-secondary);">–§–∞–π–ª–æ–≤</p>
            </div>
            <div class="stat-card">
                <h3 id="totalSize">0 MB</h3>
                <p style="color: var(--text-secondary);">–û–±—â–∏–π —Ä–∞–∑–º–µ—Ä</p>
            </div>
            <div class="stat-card">
                <h3 id="activePeers">0</h3>
                <p style="color: var(--text-secondary);">–ü–∏—Ä–æ–≤ –≤ —Å–µ—Ç–∏</p>
            </div>
        </div>

        <div class="upload-area" onclick="document.getElementById('fileInput').click()">
            <i class="fas fa-cloud-upload-alt" style="font-size: 3rem; margin-bottom: 1rem; color: var(--primary);"></i>
            <h3>–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–∞–π–ª—ã —Å—é–¥–∞ –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏</h3>
            <p style="color: var(--text-secondary); margin-top: 0.5rem;">
                –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: 1GB (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –±—Ä–∞—É–∑–µ—Ä–∞)
            </p>
            <input type="file" id="fileInput" multiple style="display: none;">
        </div>

        <div class="files-grid" id="filesGrid">
            <!-- –§–∞–π–ª—ã –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
        </div>
    </div>

    <script>
        const client = new WebTorrent();
        let files = JSON.parse(localStorage.getItem('neuron-drive-files')) || [];

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤
        document.getElementById('fileInput').addEventListener('change', function(e) {
            Array.from(e.target.files).forEach(file => {
                uploadFile(file);
            });
        });

        // Drag and drop
        const uploadArea = document.querySelector('.upload-area');
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.style.background = 'rgba(99, 102, 241, 0.1)';
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.style.background = 'rgba(99, 102, 241, 0.05)';
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.style.background = 'rgba(99, 102, 241, 0.05)';
            Array.from(e.dataTransfer.files).forEach(file => {
                uploadFile(file);
            });
        });

        function uploadFile(file) {
            if (file.size > 1024 * 1024 * 1024) { // 1GB limit
                alert('–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: 1GB');
                return;
            }

            client.seed(file, (torrent) => {
                const fileInfo = {
                    id: Date.now() + Math.random(),
                    name: file.name,
                    size: file.size,
                    formattedSize: formatFileSize(file.size),
                    type: file.type,
                    magnet: torrent.magnetURI,
                    timestamp: new Date().toLocaleString(),
                    peers: torrent.numPeers
                };
                
                files.push(fileInfo);
                saveFiles();
                renderFiles();
                updateStats();
                
                showToast(`‚úÖ –§–∞–π–ª "${file.name}" –∑–∞–≥—Ä—É–∂–µ–Ω –≤ P2P —Å–µ—Ç—å!`);
            });
        }

        function renderFiles() {
            const grid = document.getElementById('filesGrid');
            grid.innerHTML = '';

            files.forEach(file => {
                const icon = getFileIcon(file.type, file.name);
                
                const fileCard = document.createElement('div');
                fileCard.className = 'file-card';
                fileCard.innerHTML = `
                    <div class="file-icon">${icon}</div>
                    <h4 style="margin-bottom: 0.5rem; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">${file.name}</h4>
                    <div style="color: var(--text-secondary); font-size: 0.9rem;">
                        ${file.formattedSize} ‚Ä¢ ${file.timestamp}
                    </div>
                    <div style="color: var(--text-secondary); font-size: 0.8rem; margin-top: 0.5rem;">
                        üë• ${file.peers || 0} –ø–∏—Ä–æ–≤
                    </div>
                    <div class="file-actions">
                        <button class="btn btn-secondary" onclick="copyMagnet('${file.magnet}')">
                            <i class="fas fa-copy"></i>
                        </button>
                        <button class="btn btn-primary" onclick="downloadFile('${file.magnet}', '${file.name}')">
                            <i class="fas fa-download"></i>
                        </button>
                        <button class="btn btn-secondary" onclick="deleteFile('${file.id}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                grid.appendChild(fileCard);
            });
        }

        function downloadFile(magnet, filename) {
            client.add(magnet, (torrent) => {
                torrent.files[0].getBlob((err, blob) => {
                    if (err) {
                        showToast('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞');
                        return;
                    }
                    
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = filename;
                    a.click();
                    URL.revokeObjectURL(url);
                    
                    showToast(`‚úÖ –§–∞–π–ª "${filename}" —Å–∫–∞—á–∞–Ω!`);
                });
            });
        }

        function copyMagnet(magnet) {
            navigator.clipboard.writeText(magnet).then(() => {
                showToast('üîó Magnet-—Å—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!');
            });
        }

        function deleteFile(fileId) {
            if (confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —Ñ–∞–π–ª?')) {
                files = files.filter(f => f.id !== fileId);
                saveFiles();
                renderFiles();
                updateStats();
                showToast('üóëÔ∏è –§–∞–π–ª —É–¥–∞–ª–µ–Ω');
            }
        }

        function saveFiles() {
            localStorage.setItem('neuron-drive-files', JSON.stringify(files));
        }

        function updateStats() {
            document.getElementById('totalFiles').textContent = files.length;
            
            const totalSize = files.reduce((sum, file) => sum + file.size, 0);
            document.getElementById('totalSize').textContent = formatFileSize(totalSize);
            
            const totalPeers = files.reduce((sum, file) => sum + (file.peers || 0), 0);
            document.getElementById('activePeers').textContent = totalPeers;
        }

        function getFileIcon(type, name) {
            if (type.includes('image')) return '<i class="fas fa-image"></i>';
            if (type.includes('video')) return '<i class="fas fa-video"></i>';
            if (type.includes('audio')) return '<i class="fas fa-music"></i>';
            if (type.includes('pdf')) return '<i class="fas fa-file-pdf"></i>';
            if (type.includes('zip') || type.includes('rar')) return '<i class="fas fa-file-archive"></i>';
            if (name.includes('.doc')) return '<i class="fas fa-file-word"></i>';
            if (name.includes('.xls')) return '<i class="fas fa-file-excel"></i>';
            return '<i class="fas fa-file"></i>';
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        function showToast(message) {
            // –ü—Ä–æ—Å—Ç–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
            const toast = document.createElement('div');
            toast.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: var(--primary);
                color: white;
                padding: 1rem 2rem;
                border-radius: 5px;
                z-index: 1000;
                animation: slideInRight 0.3s ease;
            `;
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        renderFiles();
        updateStats();

        // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –º–µ–∂–¥—É –≤–∫–ª–∞–¥–∫–∞–º–∏
        window.addEventListener('storage', (e) => {
            if (e.key === 'neuron-drive-files') {
                files = JSON.parse(e.newValue || '[]');
                renderFiles();
                updateStats();
            }
        });
    </script>
</body>
</html>
